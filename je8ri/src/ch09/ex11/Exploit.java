package ch09.ex11;

import java.io.IOException;
import java.io.InputStream;

public class Exploit {
	public InputStream RCE(String[] command) throws IOException, InterruptedException {
		ProcessBuilder pb = new ProcessBuilder(command);
		Process process = pb.start();

		int exitCode = process.waitFor();

		if(exitCode == 0) {
			return process.getInputStream();
		} else {
			printErrorLog(process.getErrorStream());
			throw new InterruptedException("exit code :"+process.exitValue());
		}
	}
	private void printErrorLog(InputStream is) throws IOException{
		InputStreamFilter.read(is, (s) -> true).stream()
		.forEach(System.err::println);
	}
}
